{"version":3,"names":["React","useCallback","useRef","InputFocusControllerContext","Node","constructor","value","next","prev","DoublyLinkedList","newNode","tail","head","node","undefined","InputFocusController","children","refs","register","ref","current","push","unregister","remove","createOnSubmitEditing","focus","blur"],"sources":["InputFocusController.tsx"],"sourcesContent":["import { useSafeContext } from '@sirse-dev/safe-context';\r\nimport React, { PropsWithChildren, RefObject, useCallback, useRef } from 'react';\r\nimport { NativeMethods } from 'react-native';\r\n\r\nimport { InputFocusControllerContext } from './InputFocusControllerContext';\r\n\r\nexport class Node<T> {\r\n    public value: T;\r\n    public next: Node<T> | null;\r\n    public prev: Node<T> | null;\r\n    constructor(value: T) {\r\n        this.value = value;\r\n        this.next = null;\r\n        this.prev = null;\r\n    }\r\n}\r\n\r\nclass DoublyLinkedList<T> {\r\n    private head: Node<T> | null = null;\r\n    private tail: Node<T> | null = null;\r\n\r\n    public push = (value: T) => {\r\n        let newNode = new Node(value);\r\n\r\n        if (this.tail) {\r\n            this.tail.next = newNode;\r\n            newNode.prev = this.tail;\r\n            this.tail = newNode;\r\n            return this.tail;\r\n        }\r\n        this.head = newNode;\r\n        this.tail = newNode;\r\n        return this.tail;\r\n    };\r\n\r\n    public remove = (node: Node<T>) => {\r\n        if (this.head === node && node === this.tail) {\r\n            this.head = null;\r\n            this.tail = null;\r\n\r\n            return undefined;\r\n        }\r\n        if (this.head === node) {\r\n            this.head = this.head.next;\r\n            return null;\r\n        }\r\n        if (this.tail === node) {\r\n            this.tail = this.tail.prev;\r\n            if (this.tail?.next) {\r\n                this.tail.next = null;\r\n            }\r\n            return undefined;\r\n        }\r\n\r\n        if (node.next != null) {\r\n            node.next.prev = node.prev;\r\n        }\r\n        if (node.prev != null) {\r\n            node.prev.next = node.next;\r\n        }\r\n        return undefined;\r\n    };\r\n}\r\n\r\nexport const InputFocusController = ({ children }: PropsWithChildren<{}>) => {\r\n    const refs = useRef(new DoublyLinkedList<RefObject<NativeMethods | undefined>>());\r\n\r\n    const register = useCallback((ref: RefObject<NativeMethods | undefined>) => {\r\n        const node = refs.current.push(ref);\r\n        return node;\r\n    }, []);\r\n\r\n    const unregister = useCallback((node: Node<RefObject<NativeMethods | undefined>>) => {\r\n        refs.current.remove(node);\r\n    }, []);\r\n\r\n    const createOnSubmitEditing = useCallback(\r\n        (node: Node<RefObject<NativeMethods | undefined>>) => {\r\n            return () => {\r\n                if (node.next) {\r\n                    node.next.value.current?.focus();\r\n                } else {\r\n                    node.value.current?.blur();\r\n                }\r\n            };\r\n        },\r\n        [refs]\r\n    );\r\n\r\n    return (\r\n        <InputFocusControllerContext.Provider value={{ register, unregister, createOnSubmitEditing }}>\r\n            {children}\r\n        </InputFocusControllerContext.Provider>\r\n    );\r\n};\r\n"],"mappings":"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"}